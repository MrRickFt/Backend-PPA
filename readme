ğŸ“˜ Backend para la BÃºsqueda de Vuelos (PPA)
Este proyecto provee una API para gestionar y consultar vuelos en la base de datos. Incluye un endpoint para inicializar la base de datos con datos de prueba y otro para realizar bÃºsquedas de vuelos con escalas.

ğŸ“ Tabla de Contenidos
Requisitos
InstalaciÃ³n
ConfiguraciÃ³n
Estructura del Proyecto
Scripts SQL
Endpoints
EjecuciÃ³n


ğŸ“‹ Requisitos
Node.js v14+ (mejor v16+)
PostgreSQL (para manejar la base de datos)

ğŸš€ InstalaciÃ³n
Clonar el repositorio:
git clone <url_del_repositorio>
cd backend-ppa

Instalar las dependencias:
npm install

ğŸ”§ ConfiguraciÃ³n
Crear un archivo .env en la raÃ­z del proyecto con las siguientes variables de entorno:
DB_HOST=localhost
DB_USER=tu_usuario
DB_PASSWORD=tu_contraseÃ±a
DB_NAME=nombre_bd
DB_PORT=5432
PORT=3001
ConfiguraciÃ³n de base de datos en src/config/database.js. La configuraciÃ³n ya estÃ¡ preparada para leer las variables de entorno.

ğŸ“‚ Estructura del Proyecto
Este proyecto sigue una estructura de organizaciÃ³n en capas, con carpetas dedicadas a controladores, modelos, rutas, servicios, y utilidades.



backend-ppa/
â”œâ”€â”€ node_modules/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ database.js             # ConfiguraciÃ³n de Sequelize para la conexiÃ³n con PostgreSQL
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â””â”€â”€ flight.controller.js     # Controlador para manejar las operaciones de vuelos
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ airport.js               # Modelo para aeropuertos
â”‚   â”‚   â”œâ”€â”€ flight.js                # Modelo para vuelos
â”‚   â”‚   â”œâ”€â”€ route.js                 # Modelo para rutas
â”‚   â”‚   â””â”€â”€ routeLeg.js              # Modelo para escalas de rutas
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â””â”€â”€ flight.routes.js         # Rutas de vuelos
â”‚   â”œâ”€â”€ scripts/                     # Carpeta de scripts SQL para crear funciones/procedimientos almacenados
â”‚   â”‚   â”œâ”€â”€ fn_check_duplicate_flight.sql
â”‚   â”‚   â”œâ”€â”€ fn_get_flights.sql
â”‚   â”‚   â””â”€â”€ trig_before_insert_flight.sql
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ flight.service.js        # Servicio de vuelos para la lÃ³gica de negocio
â”‚   â”‚   â””â”€â”€ seed.service.js          # Servicio para cargar datos iniciales en la BD
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ httpStatusCodes.js       # Manejador de cÃ³digos HTTP
â”‚   â”‚   â”œâ”€â”€ responseHandler.js       # Manejador de respuestas estandarizadas
â”‚   â”‚   â””â”€â”€ validateParams.js        # ValidaciÃ³n de parÃ¡metros
â”‚   â”œâ”€â”€ app.js                       # ConfiguraciÃ³n de la app Express
â”‚   â””â”€â”€ server.js                    # Entrada principal de la app
â”œâ”€â”€ .env                             # Variables de entorno
â”œâ”€â”€ package.json
â””â”€â”€ README.md                        # DocumentaciÃ³n del proyecto

ğŸ—„ï¸ Scripts SQL
Para crear las funciones y procedimientos almacenados necesarios para la aplicaciÃ³n, ejecuta los scripts SQL en tu base de datos PostgreSQL. Estos scripts se encuentran en la carpeta src/scripts y deben ejecutarse en el siguiente orden:

fn_check_duplicate_flight.sql: Verifica si un vuelo ya existe en la base de datos.
fn_get_flights.sql: FunciÃ³n para obtener vuelos con o sin escalas entre dos aeropuertos.
trig_before_insert_flight.sql: Trigger para acciones antes de insertar un vuelo en la base de datos.

Puedes ejecutar estos scripts de la siguiente manera:
psql -U tu_usuario -d nombre_bd -f src/scripts/fn_check_duplicate_flight.sql
psql -U tu_usuario -d nombre_bd -f src/scripts/fn_get_flights.sql
psql -U tu_usuario -d nombre_bd -f src/scripts/trig_before_insert_flight.sql

ğŸ“š Endpoints
A continuaciÃ³n se detallan los endpoints disponibles:

1. InicializaciÃ³n de la Base de Datos
URL: http://localhost:3001/api/flights/seed
MÃ©todo: GET
DescripciÃ³n: PoblaciÃ³n inicial de la base de datos con datos de prueba.
Respuesta de Ã‰xito:
json

{
  "success": true,
  "message": "Database seeded successfully",
  "data": []
}

2. Consulta de Vuelos

URL: http://localhost:3001/api/flights

MÃ©todo: GET
DescripciÃ³n: Busca vuelos entre un origen y un destino especÃ­fico en un dÃ­a de la semana.
ParÃ¡metros de Consulta:
origin: CÃ³digo IATA del aeropuerto de origen (Ejemplo: BOG)
destination: CÃ³digo IATA del aeropuerto de destino (Ejemplo: SMR)
dayOfWeek: DÃ­a de la semana en nÃºmero (0 para domingo, 1 para lunes, etc.)

Ejemplo de PeticiÃ³n:
http://localhost:3001/api/flights?origin=BOG&destination=SMR&dayOfWeek=1

Respuesta de Ã‰xito:

json
{
  "success": true,
  "message": "Flights fetched successfully",
  "data": [
    {
      "flight_id": 3,
      "origin": "BOG",
      "destination": "SMR",
      "departure_time": "07:00:00",
      "arrival_time": "10:30:00",
      "day_of_week": 1,
      "stops": [
        "BOG",
        "BGA",
        "CLO",
        "SMR"
      ]
    },
    {
      "flight_id": 9,
      "origin": "BOG",
      "destination": "SMR",
      "departure_time": "08:30:00",
      "arrival_time": "12:00:00",
      "day_of_week": 1,
      "stops": [
        "BOG",
        "BGA",
        "CLO",
        "SMR"
      ]
    }
  ]
}

â–¶ï¸ EjecuciÃ³n
Para iniciar la aplicaciÃ³n, puedes utilizar los siguientes comandos:

Modo ProducciÃ³n:
npm start

Modo Desarrollo (con reinicio automÃ¡tico usando nodemon):
npm run start:dev
La aplicaciÃ³n se ejecutarÃ¡ en http://localhost:3001.

ğŸ› ï¸ Servicios y Utilidades
El proyecto utiliza los siguientes servicios y utilidades para organizar la lÃ³gica de negocio y las respuestas HTTP:

Servicios (src/services/): Contiene la lÃ³gica de negocio para manejar vuelos y la carga de datos iniciales.

flight.service.js: LÃ³gica para la consulta de vuelos.
seed.service.js: LÃ³gica para inicializar la base de datos.
Utilidades (src/utils/): Utilidades comunes para manejo de respuestas HTTP y validaciÃ³n de parÃ¡metros.

httpStatusCodes.js: CÃ³digos de estado HTTP comunes.
responseHandler.js: Respuestas estÃ¡ndar para Ã©xito y error.
validateParams.js: ValidaciÃ³n de parÃ¡metros de entrada en las peticiones.